{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/chat.js","webpack:///./src/services.js"],"names":["appState","pollId","isLoggedIn","usernames","messages","error","currentUser","errMsgs","renderLogin","show","loginElem","document","querySelector","logoutElem","displayUserElem","innerHTML","renderErrors","text","renderPage","renderMessages","renderUsernames","poll","shouldPoll","setInterval","fetchChatStatus","then","content","err","setAppState","clearTimeout","outgoingElem","addEventListener","e","target","classList","contains","value","fetchAddMessage","username","fetchLogin","renderOutgoing","logoutButtonElem","fetchLogout","html","map","join","messagesElem","message","sender","timestamp","toSendElem","sendButtonElem","fetch","method","headers","Headers","body","JSON","stringify","Promise","reject","response","ok","json","result"],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;ACjFA;AAAA;AAAA;AAOA,IAAMA,QAAQ,GAAG;AACfC,QAAM,EAAE,IADO;AAEfC,YAAU,EAAE,KAFG;AAGfC,WAAS,EAAE,EAHI;AAIfC,UAAQ,EAAE,EAJK;AAKfC,OAAK,EAAE,EALQ;AAMfC,aAAW,EAAE;AANE,CAAjB;AASA,IAAMC,OAAO,GAAG;AACb,mBAAiB,0DADJ;AAEb,eAAa,mEAFA;AAGb,iBAAe,2BAHF;AAIb,iBAAe,2BAJF;AAKb,mBAAiB;AALJ,CAAhB;;AAQA,SAASC,WAAT,CAAsBC,IAAtB,EAA6B;AAC3B,MAAMC,SAAS,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAlB;AACA,MAAMC,UAAU,GAAGF,QAAQ,CAACC,aAAT,CAAuB,SAAvB,CAAnB;AACA,MAAME,eAAe,GAAGH,QAAQ,CAACC,aAAT,CAAuB,mBAAvB,CAAxB;;AACA,MAAIH,IAAJ,EAAW;AACRC,aAAS,CAACK,SAAV;AAGAD,mBAAe,CAACC,SAAhB;AACAF,cAAU,CAACE,SAAX;AACF,GAND,MAMO;AACHL,aAAS,CAACK,SAAV;AACAD,mBAAe,CAACC,SAAhB,0BAA4Cf,QAAQ,CAACM,WAArD;AACAO,cAAU,CAACE,SAAX;AAGH;AACF;;AAED,SAASC,YAAT,CAAuBC,IAAvB,EAA8B;AAC5BN,UAAQ,CAACC,aAAT,CAAuB,SAAvB,EAAkCG,SAAlC,mBAAuDE,IAAvD;AACD;;AAED,SAASC,UAAT,GAAsB;AACpB,MAAG,CAAClB,QAAQ,CAACE,UAAb,EAAyB;AACvBiB,kBAAc,CAAC,EAAD,CAAd;AACAC,mBAAe,CAAC,EAAD,CAAf;AACD,GAHD,MAGO;AACLD,kBAAc,CAACnB,QAAQ,CAACI,QAAV,CAAd;AACAgB,mBAAe,CAACpB,QAAQ,CAACG,SAAV,CAAf;AACD;;AACDa,cAAY,CAAChB,QAAQ,CAACK,KAAV,CAAZ;AACD;;AAED,SAASgB,IAAT,CAAeC,UAAf,EAA4B;AAC1B,MAAIA,UAAU,IAAI,CAACtB,QAAQ,CAACC,MAA5B,EAAqC;AACnCD,YAAQ,CAACC,MAAT,GAAkBsB,WAAW,CAAE,YAAM;AACnCC,uEAAe,GACdC,IADD,CACO,UAACC,OAAD,EAAa;AAClB1B,gBAAQ,CAACE,UAAT,GAAsB,IAAtB;AACAF,gBAAQ,CAACG,SAAT,GAAqBuB,OAAO,CAAC,WAAD,CAA5B;AACA1B,gBAAQ,CAACI,QAAT,GAAoBsB,OAAO,CAAC,UAAD,CAA3B;AACAR,kBAAU;AACX,OAND,WAOQ,UAACS,GAAD,EAAS;AACfC,mBAAW,CAAED,GAAF,EAAO,KAAP,CAAX;AACAE,oBAAY,CAAC7B,QAAQ,CAACC,MAAV,CAAZ;AACAD,gBAAQ,CAACC,MAAT,GAAkB,IAAlB;AACAO,mBAAW,CAAC,IAAD,CAAX;AACAU,kBAAU;AACX,OAbD;AAcD,KAf4B,EAe1B,IAf0B,CAA7B;AAgBD,GAlByB,CAmB1B;;;AACA,MAAI,CAACI,UAAD,IAAetB,QAAQ,CAACC,MAA5B,EAAqC;AACnC4B,gBAAY,CAAC7B,QAAQ,CAACC,MAAV,CAAZ;AACAD,YAAQ,CAACC,MAAT,GAAkB,IAAlB;AACD;AACF;;AAED,IAAM6B,YAAY,GAAGnB,QAAQ,CAACC,aAAT,CAAuB,WAAvB,CAArB;AACAkB,YAAY,CAACC,gBAAb,CAA8B,OAA9B,EAAuC,UAACC,CAAD,EAAO;AAC5C,MAAG,CAACA,CAAC,CAACC,MAAF,CAASC,SAAT,CAAmBC,QAAnB,CAA4B,aAA5B,CAAJ,EAAgD;AAC9C;AACD;;AACH,MAAMlB,IAAI,GAAGN,QAAQ,CAACC,aAAT,CAAuB,UAAvB,EAAmCwB,KAAhD;AACEC,mEAAe,CAAEpB,IAAF,CAAf,CACCQ,IADD,CACM,UAACrB,QAAD,EAAc;AACjBO,YAAQ,CAACC,aAAT,CAAuB,UAAvB,EAAmCwB,KAAnC,GAA2C,EAA3C;AACAjB,kBAAc,CAACf,QAAD,CAAd;AACAJ,YAAQ,CAACK,KAAT,GAAiB,EAAjB;AACAW,gBAAY,CAAChB,QAAQ,CAACK,KAAV,CAAZ;AACF,GAND,WAOO,UAACsB,GAAD,EAAS;AACd3B,YAAQ,CAACK,KAAT,GAAiBE,OAAO,CAACoB,GAAG,CAAC,OAAD,CAAJ,CAAP,IAAyBA,GAAG,CAAC,OAAD,CAA7C;AACAX,gBAAY,CAAChB,QAAQ,CAACK,KAAV,CAAZ;AACD,GAVD;AAWD,CAhBD;AAkBA,IAAMK,SAAS,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAlB;AACAF,SAAS,CAACqB,gBAAV,CAA2B,OAA3B,EAAoC,UAACC,CAAD,EAAO;AACzC,MAAG,CAACA,CAAC,CAACC,MAAF,CAASC,SAAT,CAAmBC,QAAnB,CAA4B,cAA5B,CAAJ,EAAiD;AAC/C;AACD;;AACH,MAAMG,QAAQ,GAAG3B,QAAQ,CAACC,aAAT,CAAuB,YAAvB,EAAqCwB,KAAtD;AACEG,8DAAU,CAAED,QAAF,CAAV,CACCb,IADD,CACO,UAACC,OAAD,EAAa;AAClBE,eAAW,CAAEF,OAAF,EAAW,IAAX,CAAX;AACAL,QAAI,CAAC,IAAD,CAAJ;AACAb,eAAW,CAAC,KAAD,CAAX;AACAU,cAAU;AACVsB,kBAAc;AACf,GAPD,WAQQ,UAACb,GAAD,EAAS;AACfC,eAAW,CAAED,GAAF,EAAO,KAAP,CAAX;AACAnB,eAAW,CAAC,IAAD,CAAX;AACAU,cAAU;AACVsB,kBAAc;AACf,GAbD;AAcD,CAnBD;AAqBA,IAAMC,gBAAgB,GAAG9B,QAAQ,CAACC,aAAT,CAAuB,SAAvB,CAAzB;AACA6B,gBAAgB,CAACV,gBAAjB,CAAkC,OAAlC,EAA2C,UAACC,CAAD,EAAO;AAC/CU,+DAAW,GACVjB,IADD,CACO,UAACC,OAAD,EAAa;AAClB1B,YAAQ,CAACE,UAAT,GAAsB,KAAtB;AACAF,YAAQ,CAACK,KAAT,GAAiB,EAAjB;AACAgB,QAAI,CAAC,KAAD,CAAJ;AACAb,eAAW,CAAC,IAAD,CAAX;AACAU,cAAU;AACVsB,kBAAc;AACdxB,gBAAY,CAAChB,QAAQ,CAACK,KAAV,CAAZ;AACA,GATF,WAUQ,YAAM;AACZL,YAAQ,CAACK,KAAT,GAAiB,eAAjB;AACAa,cAAU;AACX,GAbD;AAcF,CAfD;;AAiBA,SAASE,eAAT,CAA0BjB,SAA1B,EAAsC;AACpC,MAAMwC,IAAI,GAAGxC,SAAS,CAACyC,GAAV,CAAe,UAACN,QAAD;AAAA,oFAGCA,QAHD;AAAA,GAAf,EAMXO,IANW,CAMN,EANM,CAAb;AAOAlC,UAAQ,CAACC,aAAT,CAAuB,YAAvB,EAAqCG,SAArC,GAAiD4B,IAAjD;AACD;;AAED,SAASxB,cAAT,CAAyBf,QAAzB,EAAoC;AAClC,MAAM0C,YAAY,GAAGnC,QAAQ,CAACC,aAAT,CAAuB,WAAvB,CAArB;AACA,MAAM+B,IAAI,GAAGvC,QAAQ,CAACwC,GAAT,CAAc,UAACG,OAAD;AAAA,+KAKPA,OAAO,CAACC,MALD,sGAQPD,OAAO,CAACE,SARD,2FAWKF,OAAO,CAAC9B,IAXb;AAAA,GAAd,EAcX4B,IAdW,CAcN,EAdM,CAAb;AAeAC,cAAY,CAAC/B,SAAb,GAAyB4B,IAAzB;AACD;;AAED,SAASH,cAAT,GAA0B;AACxB,MAAMV,YAAY,GAAGnB,QAAQ,CAACC,aAAT,CAAuB,WAAvB,CAArB;AACAkB,cAAY,CAACf,SAAb;AAIA,MAAMmC,UAAU,GAAGvC,QAAQ,CAACC,aAAT,CAAuB,UAAvB,CAAnB;AACA,MAAMuC,cAAc,GAAGxC,QAAQ,CAACC,aAAT,CAAuB,cAAvB,CAAvB;AACD;;AAED,SAASgB,WAAT,CAAsBF,OAAtB,EAA+BxB,UAA/B,EAA4C;AAC1C,MAAIA,UAAJ,EAAiB;AACfF,YAAQ,CAACE,UAAT,GAAsB,IAAtB;AACAF,YAAQ,CAACG,SAAT,GAAqBuB,OAAO,CAAC,WAAD,CAA5B;AACA1B,YAAQ,CAACI,QAAT,GAAoBsB,OAAO,CAAC,UAAD,CAA3B;AACA1B,YAAQ,CAACM,WAAT,GAAuBoB,OAAO,CAAC,aAAD,CAA9B;AACA1B,YAAQ,CAACK,KAAT,GAAiB,EAAjB;AACD,GAND,MAMO;AACLL,YAAQ,CAACE,UAAT,GAAsB,KAAtB;AACAF,YAAQ,CAACG,SAAT,GAAqB,EAArB;AACAH,YAAQ,CAACI,QAAT,GAAoB,EAApB;AACAJ,YAAQ,CAACM,WAAT,GAAuB,EAAvB;AACAN,YAAQ,CAACK,KAAT,GAAiBE,OAAO,CAACmB,OAAO,CAAC,OAAD,CAAR,CAAP,IAA6BA,OAAO,CAAC,OAAD,CAArD;AACD;AACF,C,CAED;;;AACAF,iEAAe,GACdC,IADD,CACO,UAAEC,OAAF,EAAe;AAClBE,aAAW,CAACF,OAAD,EAAU,IAAV,CAAX;AACAlB,aAAW,CAAC,KAAD,CAAX;AACAU,YAAU;AACVsB,gBAAc;AACdnB,MAAI,CAAC,IAAD,CAAJ;AACH,CAPD,WAQQ,UAAEK,OAAF,EAAe;AACnBE,aAAW,CAACF,OAAD,EAAU,KAAV,CAAX;AACAlB,aAAW,CAAC,IAAD,CAAX;AACAU,YAAU;AACVsB,gBAAc;AACdnB,MAAI,CAAC,KAAD,CAAJ;AACAL,cAAY,CAAC,EAAD,CAAZ;AACH,CAfD,E;;;;;;;;;;;;AC1MA;AAAA;AAAA;AAAA;AAAA;AAAO,IAAMuB,UAAU,GAAG,SAAbA,UAAa,CAACD,QAAD,EAAc;AACtC,SAAOc,KAAK,CAAC,UAAD,EAAa;AACvBC,UAAM,EAAE,MADe;AAEvBC,WAAO,EAAE,IAAIC,OAAJ,CAAY;AACnB,sBAAgB;AADG,KAAZ,CAFc;AAKvBC,QAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AAACpB,cAAQ,EAARA;AAAD,KAAf;AALiB,GAAb,CAAL,UAOC,YAAM;AACZ,WAAOqB,OAAO,CAACC,MAAR,CAAe;AAACvD,WAAK,EAAE;AAAR,KAAf,CAAP;AACD,GATM,EAUNoB,IAVM,CAUA,UAACoC,QAAD,EAAc;AACnB,QAAG,CAACA,QAAQ,CAACC,EAAb,EAAiB;AACf,aAAOD,QAAQ,CAACE,IAAT,GAAgBtC,IAAhB,CAAsB,UAAAuC,MAAM;AAAA,eAAIL,OAAO,CAACC,MAAR,CAAeI,MAAf,CAAJ;AAAA,OAA5B,CAAP;AACD;;AACD,WAAOH,QAAQ,CAACE,IAAT,EAAP;AACD,GAfM,CAAP;AAgBD,CAjBM;AAmBA,IAAMrB,WAAW,GAAG,SAAdA,WAAc,GAAM;AAC/B,SAAOU,KAAK,CAAC,UAAD,EAAa;AACvBC,UAAM,EAAE;AADe,GAAb,CAAL,UAGC,YAAM;AACZ,WAAOM,OAAO,CAACC,MAAR,CAAe;AAACvD,WAAK,EAAE;AAAR,KAAf,CAAP;AACD,GALM,EAMNoB,IANM,CAMA,UAACoC,QAAD,EAAc;AACnB,QAAG,CAACA,QAAQ,CAACC,EAAb,EAAiB;AACf,aAAOD,QAAQ,CAACE,IAAT,GAAgBtC,IAAhB,CAAsB,UAAAuC,MAAM;AAAA,eAAIL,OAAO,CAACC,MAAR,CAAeI,MAAf,CAAJ;AAAA,OAA5B,CAAP;AACD;;AACD,WAAOH,QAAQ,CAACE,IAAT,EAAP;AACD,GAXM,CAAP;AAYD,CAbM;AAeA,IAAMvC,eAAe,GAAG,SAAlBA,eAAkB,GAAM;AACnC,SAAO4B,KAAK,CAAC,aAAD,EAAgB;AAC1BC,UAAM,EAAE;AADkB,GAAhB,CAAL,UAGC,YAAM;AACZ,WAAOM,OAAO,CAACC,MAAR,CAAe;AAACvD,WAAK,EAAE;AAAR,KAAf,CAAP;AACD,GALM,EAMNoB,IANM,CAMA,UAACoC,QAAD,EAAc;AACnB,QAAG,CAACA,QAAQ,CAACC,EAAb,EAAiB;AACf,aAAOD,QAAQ,CAACE,IAAT,GAAgBtC,IAAhB,CAAsB,UAAAuC,MAAM;AAAA,eAAIL,OAAO,CAACC,MAAR,CAAeI,MAAf,CAAJ;AAAA,OAA5B,CAAP;AACD;;AACD,WAAOH,QAAQ,CAACE,IAAT,EAAP;AACD,GAXM,CAAP;AAYD,CAbM;AAeA,IAAM1B,eAAe,GAAG,SAAlBA,eAAkB,CAACpB,IAAD,EAAU;AACvC,SAAOmC,KAAK,CAAC,WAAD,EAAc;AACxBC,UAAM,EAAE,MADgB;AAExBC,WAAO,EAAE,IAAIC,OAAJ,CAAY;AACnB,sBAAgB;AADG,KAAZ,CAFe;AAKxBC,QAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AAACzC,UAAI,EAAEA;AAAP,KAAf;AALkB,GAAd,CAAL,UAOC,YAAM;AACZ,WAAO0C,OAAO,CAACC,MAAR,CAAe;AAACvD,WAAK,EAAE;AAAR,KAAf,CAAP;AACD,GATM,EAUNoB,IAVM,CAUA,UAACoC,QAAD,EAAc;AACnB,QAAG,CAACA,QAAQ,CAACC,EAAb,EAAiB;AACf,aAAOD,QAAQ,CAACE,IAAT,GAAgBtC,IAAhB,CAAsB,UAAAuC,MAAM;AAAA,eAAIL,OAAO,CAACC,MAAR,CAAeI,MAAf,CAAJ;AAAA,OAA5B,CAAP;AACD;;AACD,WAAOH,QAAQ,CAACE,IAAT,EAAP;AACD,GAfM,CAAP;AAgBD,CAjBM,C","file":"chat.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/chat.js\");\n","\r\nimport {\r\n  fetchLogin,\r\n  fetchLogout,\r\n  fetchChatStatus,\r\n  fetchAddMessage\r\n} from './services';\r\n\r\nconst appState = {\r\n  pollId: null,\r\n  isLoggedIn: false,\r\n  usernames: [],\r\n  messages: [],\r\n  error: '',\r\n  currentUser: ''\r\n};\r\n\r\nconst errMsgs = {\r\n   'network-error': 'There was a problem connecting to the network, try again',\r\n   'bad-login': \"Login cannot be empty or contain all whitespaces or contain 'dog'\",\r\n   'missing-uid': 'Please login to continue.',\r\n   'invalid-uid': 'Please login to continue.',\r\n   'empty-message': 'Message cannot be empty'\r\n};\r\n\r\nfunction renderLogin( show ) {\r\n  const loginElem = document.querySelector('.login');\r\n  const logoutElem = document.querySelector('.logout');\r\n  const displayUserElem = document.querySelector('.display-username');\r\n  if( show ) {\r\n     loginElem.innerHTML = `\r\n     <input class=\"user-name\" type=\"text\" value=\"\" placeholder=\"Enter username\"/>\r\n     <button class=\"login-button\" type=\"button\">Login</button>`;\r\n     displayUserElem.innerHTML = ``;\r\n     logoutElem.innerHTML = ``;\r\n  } else {\r\n      loginElem.innerHTML = ``;\r\n      displayUserElem.innerHTML = `<span> Hello ${appState.currentUser}</span>`\r\n      logoutElem.innerHTML = `\r\n      <button class=\"logout-button\" type=\"button\">Logout</button>\r\n     `;\r\n  }\r\n}\r\n\r\nfunction renderErrors( text ) {\r\n  document.querySelector('.status').innerHTML = `<span>${text}</span>`;\r\n}\r\n\r\nfunction renderPage() {\r\n  if(!appState.isLoggedIn) {\r\n    renderMessages([]);\r\n    renderUsernames([]);\r\n  } else {\r\n    renderMessages(appState.messages);\r\n    renderUsernames(appState.usernames);\r\n  }\r\n  renderErrors(appState.error);\r\n}\r\n\r\nfunction poll( shouldPoll ) {\r\n  if( shouldPoll && !appState.pollId ) {\r\n    appState.pollId = setInterval( () => {\r\n      fetchChatStatus()\r\n      .then( (content) => {\r\n        appState.isLoggedIn = true;\r\n        appState.usernames = content['usernames'];\r\n        appState.messages = content['messages'];\r\n        renderPage();\r\n      })\r\n      .catch( (err) => {\r\n        setAppState( err, false);\r\n        clearTimeout(appState.pollId);\r\n        appState.pollId = null;\r\n        renderLogin(true);\r\n        renderPage();\r\n      });\r\n    }, 3000);\r\n  }\r\n  // For when a user logs out:\r\n  if( !shouldPoll && appState.pollId ) {\r\n    clearTimeout(appState.pollId);\r\n    appState.pollId = null;\r\n  }\r\n}\r\n\r\nconst outgoingElem = document.querySelector('.outgoing');\r\noutgoingElem.addEventListener('click', (e) => {\r\n  if(!e.target.classList.contains('send-button')) {\r\n    return;\r\n  }\r\nconst text = document.querySelector('.to-send').value;\r\n  fetchAddMessage( text )\r\n  .then((messages) => {\r\n     document.querySelector('.to-send').value = ''\r\n     renderMessages(messages);\r\n     appState.error = '';\r\n     renderErrors(appState.error);\r\n  })\r\n  .catch((err) => {\r\n    appState.error = errMsgs[err['error']] || err['error'];\r\n    renderErrors(appState.error);\r\n  });\r\n});\r\n\r\nconst loginElem = document.querySelector('.login');\r\nloginElem.addEventListener('click', (e) => {\r\n  if(!e.target.classList.contains('login-button')) {\r\n    return;\r\n  }\r\nconst username = document.querySelector('.user-name').value;\r\n  fetchLogin( username )\r\n  .then( (content) => {\r\n    setAppState( content, true );\r\n    poll(true);\r\n    renderLogin(false);\r\n    renderPage();\r\n    renderOutgoing();\r\n  })\r\n  .catch( (err) => {\r\n    setAppState( err, false);\r\n    renderLogin(true);\r\n    renderPage();\r\n    renderOutgoing();\r\n  });\r\n});\r\n\r\nconst logoutButtonElem = document.querySelector('.logout');\r\nlogoutButtonElem.addEventListener('click', (e) => {\r\n   fetchLogout()\r\n   .then( (content) => {\r\n     appState.isLoggedIn = false;\r\n     appState.error = '';\r\n     poll(false);\r\n     renderLogin(true);\r\n     renderPage();\r\n     renderOutgoing();\r\n     renderErrors(appState.error);\r\n    })\r\n   .catch( () => {\r\n     appState.error = 'logout-failed';\r\n     renderPage();\r\n   });\r\n});\r\n\r\nfunction renderUsernames( usernames ) {\r\n  const html = usernames.map( (username) =>\r\n  `<li>\r\n    <div class=\"user\">\r\n      <span class=\"username\">${username}</span>\r\n    </div>\r\n  </li>`\r\n  ).join('')\r\n  document.querySelector('.usernames').innerHTML = html;\r\n}\r\n\r\nfunction renderMessages( messages ) {\r\n  const messagesElem = document.querySelector('.messages');\r\n  const html = messages.map( (message) =>\r\n    `<li class=\"message-row\">\r\n      <div class=\"message\">\r\n        <div class=\"meta-info\">\r\n           <div class=\"sender-info\">\r\n              <span>${message.sender}</span>\r\n           </div>\r\n           <div class=\"message-info\">\r\n              <span>${message.timestamp}</span>\r\n           </div>\r\n        </div>\r\n        <p class=\"message-text\">${message.text}</p>\r\n      </div>\r\n    </li>`\r\n  ).join('');\r\n  messagesElem.innerHTML = html;\r\n}\r\n\r\nfunction renderOutgoing() {\r\n  const outgoingElem = document.querySelector('.outgoing');\r\n  outgoingElem.innerHTML = `\r\n     <input class=\"to-send\" type=\"text\" value=\"\" required=\"true\" placeholder=\"Enter your text\"/>\r\n     <button class=\"send-button\" type=\"button\">Send</button>`;\r\n\r\n  const toSendElem = document.querySelector('.to-send');\r\n  const sendButtonElem = document.querySelector('.send-button');\r\n}\r\n\r\nfunction setAppState( content, isLoggedIn ) {\r\n  if( isLoggedIn ) {\r\n    appState.isLoggedIn = true;\r\n    appState.usernames = content['usernames'];\r\n    appState.messages = content['messages'];\r\n    appState.currentUser = content['currentUser'];\r\n    appState.error = '';\r\n  } else {\r\n    appState.isLoggedIn = false\r\n    appState.usernames = [];\r\n    appState.messages = [];\r\n    appState.currentUser = '';\r\n    appState.error = errMsgs[content['error']] || content['error'] ;\r\n  }\r\n}\r\n\r\n// on load\r\nfetchChatStatus()\r\n.then( ( content ) => {\r\n    setAppState(content, true);\r\n    renderLogin(false);\r\n    renderPage();\r\n    renderOutgoing();\r\n    poll(true);\r\n})\r\n.catch( ( content ) => {\r\n    setAppState(content, false);\r\n    renderLogin(true);\r\n    renderPage();\r\n    renderOutgoing();\r\n    poll(false);\r\n    renderErrors('');\r\n});\r\n","export const fetchLogin = (username) => {\r\n  return fetch('/session', {\r\n    method: 'POST',\r\n    headers: new Headers({\r\n      'content-type': 'application/json'\r\n    }),\r\n    body: JSON.stringify({username}),\r\n  })\r\n  .catch( () => {\r\n    return Promise.reject({error: 'network-error'});\r\n  })\r\n  .then( (response) => {\r\n    if(!response.ok) {\r\n      return response.json().then( result => Promise.reject(result) );\r\n    }\r\n    return response.json();\r\n  });\r\n};\r\n\r\nexport const fetchLogout = () => {\r\n  return fetch('/session', {\r\n    method: 'DELETE',\r\n  })\r\n  .catch( () => {\r\n    return Promise.reject({error: 'network-error'});\r\n  })\r\n  .then( (response) => {\r\n    if(!response.ok) {\r\n      return response.json().then( result => Promise.reject(result) );\r\n    }\r\n    return response.json();\r\n  });\r\n};\r\n\r\nexport const fetchChatStatus = () => {\r\n  return fetch('/chatStatus', {\r\n    method: 'GET',\r\n  })\r\n  .catch( () => {\r\n    return Promise.reject({error: 'network-error'})\r\n  })\r\n  .then( (response) => {\r\n    if(!response.ok) {\r\n      return response.json().then( result => Promise.reject(result));\r\n    }\r\n    return response.json();\r\n  });\r\n};\r\n\r\nexport const fetchAddMessage = (text) => {\r\n  return fetch('/messages', {\r\n    method: 'POST',\r\n    headers: new Headers({\r\n      'content-type': 'application/json'\r\n    }),\r\n    body: JSON.stringify({text: text})\r\n  })\r\n  .catch( () => {\r\n    return Promise.reject({error: 'network-error'});\r\n  })\r\n  .then( (response) => {\r\n    if(!response.ok) {\r\n      return response.json().then( result => Promise.reject(result) );\r\n    }\r\n    return response.json();\r\n  });\r\n};\r\n"],"sourceRoot":""}